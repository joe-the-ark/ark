{% load i18n %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="icon" href="/static/images/favicon.ico"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"/>
    <meta name="theme-color" content="#51ceec"/>
    <meta name="description" content="ARK"/>
    <title>Inner_Safety</title>
    <link rel="stylesheet" href="/static/css/app.css">
    <link rel="stylesheet" href="/static/css/ubung-1.css">
    <script src="/static/vue.js"></script>
    <!-- å¼•å…¥æ ·å¼ -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- å¼•å…¥ç»„ä»¶åº“ -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
</head>
<body>
    {% get_current_language as LANGUAGE_CODE %}
<div class="app">
    <div class="app__head">
        <header class="header-main container">
            <div class="header-main__title">
                <icon classs="icon" onClick="window.open('https://info.arks.ch/');" style="cursor: pointer; position: relative; display: inline-flex; align-items: center;">
                <span class="icon-logo"></span>
                <span>ARKS</span>
                <span class="tooltip-icon arks-logo-tooltip" id="arks-logo-tooltip-icon" style="display: none; margin-left: 8px;">{% trans "Info zu safecircles.ch" %}</span>
            </icon>
            </div>
            <div class="header-main__user" style="background-color: #FFFFFF; color: #626262; border-radius: 10px; padding: 0 10px;">
              <div class="language-selector" style="display:inline-block;">
                <form action="{% url 'set_language' %}" method="post" style="vertical-align:middle;">{% csrf_token %}
                    <input name="next" type="hidden" value="">
                    {% get_current_language as LANGUAGE_CODE %}
                    {% if LANGUAGE_CODE == 'zh-hans' %}
                        <img id="flag" src="{% static 'images/flags/4_zh-hans_transparent.png' %}" style="width:20%;vertical-align:middle;padding-left:1px" alt="language flag">
                    {% elif LANGUAGE_CODE == 'de' %}
                        <img id="flag" src="{% static 'images/flags/1_de_transparent.png' %}" style="width:20%;vertical-align:middle;padding-left:1px" alt="language flag">
                    {% elif LANGUAGE_CODE == 'fr' %}
                        <img id="flag" src="{% static 'images/flags/3_fr_transparent.png' %}" style="width:20%;vertical-align:middle;padding-left:1px" alt="language flag">
                    {% elif LANGUAGE_CODE == 'tr' %}
                        <img id="flag" src="{% static 'images/flags/5_tr_transparent.png' %}" style="width:20%;vertical-align:middle;padding-left:1px" alt="language flag">
                    {% else %}
                        <img id="flag" src="{% static 'images/flags/2_en_transparent.png' %}" style="width:20%;vertical-align:middle;padding-left:1px" alt="language flag">
                    {% endif %}
                    <select onchange="updateLanguageFlag(); this.form.submit();" name="language" id="select_" style="width: auto; vertical-align:middle; border-radius: 10px; padding: 10px;" aria-label="{% trans 'Sprache auswÃ¤hlen' %}">
                        <option value="" selected>{% trans "Sprachauswahl" %}</option>
                        {% get_available_languages as LANGUAGES %}
                        {% get_language_info_list for LANGUAGES as languages %}
                        {% for language in languages %}
                            <option value="{{ language.code }}">
                                {{ language.name_local }}
                            </option>
                        {% endfor %}
                    </select>
                </form>
              </div>
                <div class="user">
                    <div class="user__subtitle">
                        {{game.name}}<br>
                        <button class="copy-link-button" id="copy-link-button" type="button" aria-label="{% trans 'Link kopieren' %}" data-clipboard-text="#link_url">
                            <span class="copy-link-icon">ðŸ“‹</span>
                            <span class="copy-link-text">{% trans "Link kopieren" %}</span>
                            <span class="copy-link-success" style="display: none;">âœ“ {% trans "Kopiert!" %}</span>
                        </button>
                    </div>
                    <img src="{{user.avatar}}" alt="{{user.name}}">
                    <div class="user__title">
                        {{user.name}}
                    </div>                    
                </div>
            </div>
            <div class="header-main__progress">
                <div class="progress">
                    <label>{% trans "INDIVIDUUM" %}</label>
                    <div class="progress__bar">
                        <div style="width: 10%; border-radius: 10px;">10%</div>
                    </div>
                </div>
            </div>
        </header>
    </div>
    <div class="app__body" id="app-1">
        <div class="container"
        v-loading="loading"
        element-loading-text="Waiting for the server"
        element-loading-background="rgba(0, 0, 0, 0.8)">
                <main class="screen ubung-1">
                    <h1>
                        <span class="tooltip-icon safety-anchor-tooltip-icon" id="safety-anchor-tooltip-icon" style="display: inline-flex; align-items: center; margin-right: 8px; vertical-align: middle; cursor: help;">?</span>
                        {% trans "Was beschreibt am besten deinen SICHERHEITSANKER im Team?" %}
                    </h1>
                    <div style="border: 1px solid #ccc; border-radius: 10px; padding: 10px;">

                    <p>
                        {% trans "Entscheide spontan â€“ du kannst den Begriff spÃ¤ter noch korrigieren." %}
                    </p>

                    <p>
                    <img src="http://info.arks.ch/wp-content/uploads/2022/07/Plus.png" style="border-radius: 10px;"><br>

                    </p>

                    <p style="background-color: #52CEEC; color: #FFFFFF; border-radius: 10px; padding: 0 10px;">
                        {% trans "WÃ¤hle den positiven Endpunkt, der dein SicherheitsgefÃ¼hl im Team stÃ¤rkt..." %}
                        <br><br>
                    </p>

                    <div class="tags" role="group" aria-label="{% trans 'Sicherheitsanker-Begriffe' %}">
                        <span :id="item.value" 
                              v-bind:class="{ tag: item.state==='tag', 'line-through': item.state !== 'tag', 'tag-selected': item.state === 'line-through' && item.player_id === currentPlayerId, 'tag-disabled': item.state === 'line-through' && item.player_id !== currentPlayerId}" 
                              v-for="item in term_list" 
                              @click="mark( item.value )" 
                              @keydown.enter="mark( item.value )"
                              @keydown.space.prevent="mark( item.value )"
                              :tabindex="item.state === 'line-through' && item.player_id !== currentPlayerId ? -1 : 0"
                              :aria-label="item.state === 'line-through' && item.player_id !== currentPlayerId ? '{% trans 'Bereits gewÃ¤hlt' %}' : item.value"
                              role="button"
                              style="border-radius: 10px; transition: all 0.3s ease; position: relative;">[[ item.value ]]</span>

                        {% comment %} <span id="AufmuÌˆpfigkeit" class="tag">AufmuÌˆpfigkeit</span>
                        <span id="Autonomie" class="line-through" class="tag">Autonomie</span>
                        <span id="Dominanz" class="tag">Dominanz</span>
                        <span id="Effizienz" class="tag">Effizienz</span>
                        <span id="Ehrgeiz" class="tag">Ehrgeiz</span>
                        <span id="Einzigartigkeit" class="line-through" class="tag">Einzigartigkeit</span>
                        <span id="Erfolg" class="tag">Erfolg</span>
                        <span id="FlexibilitaÌˆt" class="tag">FlexibilitaÌˆt</span>
                        <span id="Freundschaft" class="tag">Freundschaft</span>
                        <span id="Gelassenheit" class="line-through" class="tag">Gelassenheit</span>
                        <span id="Gerechtigkeit" class="tag">Gerechtigkeit</span>
                        <span id="Geselligkeit" class="tag">Geselligkeit</span>
                        <span id="Gleichberechtigung" class="tag">Gleichberechtigung</span>
                        <span id="GroÃŸzuÌˆgigkeit" class="tag">GroÃŸzuÌˆgigkeit</span>
                        <span id="Imagination" class="tag">Imagination</span>
                        <span id="Leidenschaft" class="line-through" class="tag">Leidenschaft</span>
                        <span id="LoyalitaÌˆt" class="tag">LoyalitaÌˆt</span>
                        <span id="Mut" class="tag">Mut</span>
                        <span id="Nachhaltigkeit" class="tag">Nachhaltigkeit</span>
                        <span id="Neugier" class="line-through" class="tag">Neugier</span>
                        <span id="Offenheit" class="tag">Offenheit</span>
                        <span id="Sicherheit" class="tag">Sicherheit</span>
                        <span id="Sinnhaftigkeit" class="tag">Sinnhaftigkeit</span>
                        <span id="SolidaritÃ¤t" class="line-through" class="tag">SolidaritÃ¤t</span>
                        <span id="Sorgfalt" class="tag">Sorgfalt</span>
                        <span id="VergnuÌˆgen" class="tag">VergnuÌˆgen</span>
                        <span id="Vertrautheit" class="tag">Vertrautheit</span>
                        <span id="WuÌˆrde" class="tag">WuÌˆrde</span>
                        <span id="ZuverlaÌˆssigkeit" class="tag">ZuverlaÌˆssigkeit</span> {% endcomment %}
                    </div>
                    <div class="input-container">
                        <input type="text" 
                               placeholder="{% trans '...oder einen eigenen Begriff eingeben' %}" 
                               name="kraftquelle" 
                               v-model="text_input" 
                               @keyup.enter="add_term" 
                               @keyup="keyboard_()" 
                               @input="updateCharacterCount"
                               maxlength="15" 
                               minlength="2"
                               id="safety-anchor-input"
                               aria-label="{% trans 'Sicherheitsanker eingeben' %}"
                               style="border-radius: 10px; padding: 8px 12px; width: 100%; max-width: 410px; box-sizing: border-box;">
                        <div class="input-feedback" v-if="text_input.length > 0 && keyboard_input">
                            <span class="character-count" :class="{ 'character-count-warning': text_input.length > 12 }">
                                [[ text_input.length ]]/15
                            </span>
                        </div>
                    </div>
                    <label id="already-chosen-label" class="already-chosen-label" style="display: none;" role="alert" aria-live="polite">
                        *{% trans "Dieser Begriff wurde bereits von einem anderen Mitreisenden gewÃ¤hlt." %}
                    </label>
                    <div id="validation-error" class="validation-error" role="alert" aria-live="polite" style="display: none;">
                        <strong>{% trans "Bitte wÃ¤hle einen Sicherheitsanker" %}</strong><br>
                        <span class="validation-error-text">{% trans "Du musst einen Begriff auswÃ¤hlen oder einen eigenen eingeben, bevor du fortfahren kannst." %}</span>
                    </div>

                    <input id="tags" type="hidden" name="tags" value="EnterValue">
                    </div>


                    <div class="center">
                        {% comment %} <a href="/ubung-3/"> {% endcomment %}
                            <p>
                            <button class="button button-primary" type="button" @click="continue_()" id="submit-button" aria-label="{% trans 'Weiter' %}">
                                <span class="button-text">{% trans "Weiter" %}</span>
                                <span class="button-arrow">â†’</span>
                            </button></a>
                        </p>
                    <div class="copyright-footer">
                        <a href="https://github.com/joe-the-ark/ark" target="_blank">{% trans "ARKS is published under a GPLv3" %}</a> {% trans "license by" %} 
                        <a href="https://www.linkedin.com/in/dr-joe-maier/" target="_blank">{% trans "Dr. Joe Maier" %}</a>.
                    </div>
                    </div>
                </main>
        </div>
    </div>
</div>

<script src="/static/jquery-3.5.1.min.js"></script>
  <script src="/static/axios.min.js"></script>
  {% comment %} <script src="/static/vue.js"></script> {% endcomment %}
  <script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js"></script>
  <script src="https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js"></script>
  <script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
<script>
    // Link creation
    var temp_link = '{{ game.link }}';
    var url_host = window.location.host;
    var temp_link_ = url_host + '/link/' + temp_link;
    
    // Copy link button with improved feedback
    const copyLinkButton = document.getElementById('copy-link-button');
    const copyLinkText = copyLinkButton ? copyLinkButton.querySelector('.copy-link-text') : null;
    const copyLinkSuccess = copyLinkButton ? copyLinkButton.querySelector('.copy-link-success') : null;
    
    if (copyLinkButton) {
        copyLinkButton.dataset.clipboardText = temp_link_;
        const clipboard = new ClipboardJS(copyLinkButton);
        
        clipboard.on('success', function(e) {
            e.clearSelection();
            
            // Show success feedback
            if (copyLinkText) copyLinkText.style.display = 'none';
            if (copyLinkSuccess) {
                copyLinkSuccess.style.display = 'inline';
                copyLinkButton.classList.add('copy-link-button--success');
            }
            
            // Reset after 2 seconds
            setTimeout(function() {
                if (copyLinkText) copyLinkText.style.display = 'inline';
                if (copyLinkSuccess) copyLinkSuccess.style.display = 'none';
                copyLinkButton.classList.remove('copy-link-button--success');
            }, 2000);
        });
        
        clipboard.on('error', function(e) {
            console.error('Failed to copy link:', e);
        });
    }
    
    // ARKS Logo Tooltip
    const arksLogoContainer = document.querySelector('.header-main__title icon');
    const arksLogoTooltipIcon = document.getElementById('arks-logo-tooltip-icon');
    
    if (arksLogoContainer && arksLogoTooltipIcon) {
        arksLogoContainer.addEventListener('mouseenter', function() {
            arksLogoTooltipIcon.style.display = 'inline-flex';
        });
        arksLogoContainer.addEventListener('mouseleave', function() {
            arksLogoTooltipIcon.style.display = 'none';
        });
        
        tippy(arksLogoTooltipIcon, {
            content: "{% trans 'Info zu safecircles.ch'|escapejs %}",
            placement: 'bottom',
            theme: 'light',
            delay: [200, 0],
            allowHTML: false,
            interactive: false,
            trigger: 'mouseenter focus',
            maxWidth: 300,
        });
    }
    
    // Initialize tooltip when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSafetyAnchorTooltip);
    } else {
        // DOM is already ready
        setTimeout(initSafetyAnchorTooltip, 100);
    }
    
    // Also initialize after Vue has mounted (if Vue is used)
    setTimeout(function() {
        if (typeof app !== 'undefined') {
            app.$nextTick(function() {
                setTimeout(initSafetyAnchorTooltip, 200);
            });
        } else {
            // If Vue app is not yet defined, try again later
            setTimeout(initSafetyAnchorTooltip, 500);
        }
    }, 100);
    
    // Update flag based on current language
    function updateLanguageFlag() {
        var lang_code = $('#select_').val();
        if (lang_code == 'zh-hans'){
            $("#flag").attr("src", "{% static 'images/flags/4_zh-hans_transparent.png'%}");
        } else if (lang_code == 'de'){
            $("#flag").attr("src", "{% static 'images/flags/1_de_transparent.png'%}");
        } else if (lang_code == 'en'){
            $("#flag").attr("src", "{% static 'images/flags/2_en_transparent.png'%}");
        } else if (lang_code == 'fr'){
            $("#flag").attr("src", "{% static 'images/flags/3_fr_transparent.png'%}");
        } else if (lang_code == 'tr'){
            $("#flag").attr("src", "{% static 'images/flags/5_tr_transparent.png' %}");
        }
    }
    
    // Initialize language flag on page load
    updateLanguageFlag();
    
    // Set "Sprachauswahl" as default display in select (flag shows current language)
    $(document).ready(function() {
        $('#select_').val('');
    });

    function sleep (time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }

    // Initialize Safety Anchor Tooltip first
    function initSafetyAnchorTooltip() {
        const safetyAnchorTooltipIcon = document.getElementById('safety-anchor-tooltip-icon');
        if (safetyAnchorTooltipIcon) {
            // Destroy existing tooltip if any
            const existingInstance = safetyAnchorTooltipIcon._tippy;
            if (existingInstance) {
                existingInstance.destroy();
            }
            
            tippy(safetyAnchorTooltipIcon, {
                content: "{% trans 'Indem wir unseren Anker bewusst erkennen und pflegen, schaffen wir eine solide Basis, die es uns erlaubt, auch in unsicheren oder konfliktreichen Situationen gelassen und souverÃ¤n zu bleiben.'|escapejs %}",
                placement: 'bottom',
                theme: 'light',
                delay: [200, 0],
                allowHTML: false,
                interactive: false,
                trigger: 'mouseenter focus',
                maxWidth: 500,
            });
        }
    }

    console.log('{{ LANGUAGE_CODE }}')
    if ('{{LANGUAGE_CODE}}' == 'zh-hans' ){
        var term_list_i18n = eval({{term_list|safe}})['Chinese']
    }
    if ('{{LANGUAGE_CODE}}' == 'de'){
        var term_list_i18n = eval({{term_list|safe}})['Deutsch']
    }
    if ('{{LANGUAGE_CODE}}' == 'fr'){
        var term_list_i18n = eval({{term_list|safe}})['French']
    }
    if ('{{LANGUAGE_CODE}}' == 'en'){
        var term_list_i18n = eval({{term_list|safe}})['English']
    }
    if ('{{LANGUAGE_CODE}}' == 'tr'){
        var term_list_i18n = eval({{term_list|safe}})['Turkish']
    }
    var app = new Vue({
        delimiters: ['[[', ']]'],
        el: '#app-1',
        data:{
            text_input: '',
            //term_list: {{ term_list|safe }},
            term_list: term_list_i18n,
            loading: false,
            keyboard_input: false,
            currentPlayerId: {{user.id}},
            showAlreadyChosen: false,
        },
        mounted(){
            var that = this;

            var flag = 0; // test whether the user have already select the term.
            var uu = 0;
            var player_id = {{user.id}};
            while (uu < that.term_list.length){
                if (that.term_list[uu].player_id === player_id){
                    flag = 1;
                    that.text_input = that.term_list[uu].value;
                    break;
                }
                uu += 1;
            }
            
            // Initialize tooltip after Vue has mounted
            that.$nextTick(function() {
                setTimeout(function() {
                    if (typeof initSafetyAnchorTooltip === 'function') {
                        initSafetyAnchorTooltip();
                    }
                }, 100);
            });

            var data_ = {
                'player_id': '{{user.id}}',
                'link': '{{game.link}}',
            }
            {% comment %} axios
                .post(`/api/check_ubung_1/`, data_)
                .then(function(response){
                    var result = response.data.result;
                    if (String(result) === "0"){
                        var data_ = {
                            'player_id': '{{user.id}}',
                            'link': '{{game.link}}',
                            'data': that.term_list,
                        };
                        axios
                            .post(`/api/ubung_1_api/`, data_)
                            .then(function(response){
                                var result = response.data.result;
                                console.log(result);
                                that.term_list.splice(0);
                                var uu = 0;
                                while (uu < result.length){
                                    that.term_list.push(result[uu]);
                                    uu += 1;
                                }
                            })
                            .catch(function(error){
                                console.log(error);
                            })
                    }
                }) {% endcomment %}
            //this.get_api_data();

        },
        methods:{
            keyboard_(){
                var that = this;
                that.keyboard_input = true;
                return
            },
            updateCharacterCount(){
                // Character count is handled by v-if in template
            },
            get_api_data(){
                var that = this;
                var data_ = {
                    'player_id': '{{user.id}}',
                    'link': '{{game.link}}',
                }
                axios
                    .post('/api/ubung_1_get_data/', data_)
                    .then(function(response){
                        var result = response.data.result;
                        //console.log(result);
                        that.term_list.splice(0);
                        var uu = 0;
                        while (uu < result.length){
                            that.term_list.push(result[uu]);
                            uu += 1;
                        }
                    })
                    .catch(function(error){
                        console.log(error);
                    })
            },
            continue_:function(){
                var that = this;
                const validationError = document.getElementById('validation-error');
                
                if (that.text_input === ''){
                    // Show validation error
                    if (validationError) {
                        validationError.style.display = 'block';
                        validationError.setAttribute('role', 'alert');
                        
                        // Focus on input or first tag
                        const input = document.getElementById('safety-anchor-input');
                        if (input) {
                            input.focus();
                            input.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                        
                        // Hide error after 8 seconds
                        setTimeout(function() {
                            if (validationError) {
                                validationError.style.display = 'none';
                            }
                        }, 8000);
                    }
                    return;
                } else {
                    // Hide error if visible
                    if (validationError) {
                        validationError.style.display = 'none';
                    }
                    
                    // Show loading state
                    that.loading = true;
                    
                    // Disable button during submission
                    const submitButton = document.getElementById('submit-button');
                    if (submitButton) {
                        submitButton.disabled = true;
                        submitButton.classList.add('button-submitting');
                    }
                    
                    //if (this.keyboard_input === true){
                        app.add_term();
                    //}else{
                        //window.location.href = "/ubung-3/";
                    //}
                }
            },
            add_term: function(){
                var that = this;
                var temp = that.text_input
                temp = temp.replace(/\s*/g,"")
                if (that.text_input ===  ''){
                    return;
                }
                if (temp === ''){
                    return;
                }
                var flag = 0; // test whether the user have already select the term.
                var uu = 0;
                var player_id = {{user.id}};
                while (uu < that.term_list.length){
                    if (that.term_list[uu].player_id === player_id){
                        flag = 1;
                        that.term_list[uu].state = 'tag';
                        break;
                    }
                    uu += 1;
                }

                // if have the same value, interrupt
                //var ii = 0;
                //var flag_ = 0;
                //while (ii < that.term_list.length){
                //    if (that.term_list[ii].value === that.text_input){
                //        flag_ = 1;
                //        alert("You input the same term which is below.")
                //        return;
                //    }
                //    ii += 1;
                //}

                //if (flag === 1){
                //    return;
                //}
                //that.term_list.push({
                //    'state': 'line-through',
                //    'value': that.text_input,
                //    'player_id': {{user.id}},
                //});
                var data_ = {
                    'player_id': '{{user.id}}',
                    'link': '{{game.link}}',
                    'item': temp,
                    'lang_code': '{{LANGUAGE_CODE}}'
                };
                axios
                    .post('/api/ubung_1_api_pro/', data_)
                    .then(function(response){
                        var result = response.data.result;
                        //console.log(result);

                        let new_term_list = that.term_list
                        let uu = 0
                        let flag = 0
                        while (uu < new_term_list.length){
                            if (new_term_list[uu].value == temp){
                                new_term_list[uu].state = 'line-through'
                                flag = 1
                            }else{
                                new_term_list[uu].state = 'tag'
                            }
                            uu += 1
                        }
                        if (flag == 0){
                            new_term_list.push({value: temp, state: 'line-through', player_id: '{{user.id}}'})
                        }
                        that.term_list = new_term_list
                        
                        // Hide loading state
                        that.loading = false;
                        
                        // Re-enable button
                        const submitButton = document.getElementById('submit-button');
                        if (submitButton) {
                            submitButton.disabled = false;
                            submitButton.classList.remove('button-submitting');
                        }

                        //that.term_list.splice(0);
                        //var uu = 0;
                        //while (uu < result.length){
                        //    that.term_list.push(result[uu]);
                        //    uu += 1;
                        //}
                    })
                    .catch(function(error){
                        console.error('Error in add_term:', error);
                        that.loading = false;
                        
                        // Re-enable button
                        const submitButton = document.getElementById('submit-button');
                        if (submitButton) {
                            submitButton.disabled = false;
                            submitButton.classList.remove('button-submitting');
                        }
                        
                        // Show error message
                        const apiError = document.getElementById('api-error');
                        const apiErrorText = document.getElementById('api-error-text');
                        if (apiError && apiErrorText) {
                            apiErrorText.textContent = "{% trans 'Ein Fehler ist aufgetreten. Bitte versuche es erneut.'|escapejs %}";
                            apiError.style.display = 'block';
                            setTimeout(function() {
                                if (apiError) {
                                    apiError.style.display = 'none';
                                }
                            }, 5000);
                        }
                    })
                window.location.href = "/ubung-3/";
            },
            mark: function(item){
                //clearInterval(refresh);
                var that = this;
                this.keyboard_input = false;
                this.loading = true;
                var player_id = {{user.id}};
                const alreadyChosenLabel = document.getElementById('already-chosen-label');
                const validationError = document.getElementById('validation-error');

                var already_ = 0;
                var flag = 0; // test whether the user have already select the term.
                var uu = 0;
                while (uu < that.term_list.length){
                    if (that.term_list[uu].player_id === player_id){
                        flag = 1;
                        already_ = uu;
                        break;
                    }
                    uu += 1;
                }

                var uu = 0;
                while (uu < that.term_list.length){
                    if (that.term_list[uu].value == item){
                        //this.term_list[uu].state = 'line-through';
                        //break;
                        if (that.term_list[uu].state === 'tag'){
                            if (flag === 1){
                                that.term_list[already_].state = 'tag';
                                //return;
                            }
                            that.term_list[uu].state = 'line-through';
                            that.text_input = item;
                            // Hide validation error if visible
                            if (validationError) {
                                validationError.style.display = 'none';
                            }
                            if (alreadyChosenLabel) {
                                alreadyChosenLabel.style.display = 'none';
                            }
                            break;
                        }
                        else if (that.term_list[uu].state === 'line-through'){
                            if (that.term_list[uu].player_id !== player_id){
                                // Show "already chosen" message
                                if (alreadyChosenLabel) {
                                    alreadyChosenLabel.style.display = 'block';
                                    setTimeout(function() {
                                        if (alreadyChosenLabel) {
                                            alreadyChosenLabel.style.display = 'none';
                                        }
                                    }, 5000);
                                }
                                that.loading = false;
                                return;
                            }
                            that.term_list[uu].state = 'tag';
                            that.text_input = '';
                            if (alreadyChosenLabel) {
                                alreadyChosenLabel.style.display = 'none';
                            }
                            break;
                        }
                    }
                    uu += 1;
                }
                var data_ = {
                    'player_id': '{{user.id}}',
                    'link': '{{game.link}}',
                    'item': item,
                    'lang_code': '{{LANGUAGE_CODE}}'
                };
                console.log('item', item)
                //console.log(that.term_list);
                //console.log(data_)
                axios
                    .post('/api/ubung_1_api_pro/', data_)
                    .then(function(response){
                        var result = response.data.result;
                        //console.log('result',result[0].value);
                        
                        //console.log(that.term_list)
                        let new_term_list = that.term_list
                        let uu = 0 
                        let flag = 0
                        while (uu < new_term_list.length){
                            if (new_term_list[uu].value == item){
                                new_term_list[uu].state = 'line-through'
                                flag = 1
                            } else {
                                new_term_list[uu].state = 'tag'
                            }
                            uu += 1
                        }
                        if (flag == 0){
                            new_term_list.push({value: item, state: 'line-through', player_id: '{{user.id}}'})
                        }
                        console.log('new_term_list', new_term_list)
                        //that.term_list.splice(0)
                        that.term_list = new_term_list

                        //that.term_list.splice(0);
                        //let ii = 0;
                        //while (ii < new_term_list.length){
                        //    that.term_list.push(new_term_list[ii]);
                        //    ii += 1;
                        //}
                
                    })
                    .catch(function(error){
                        console.log(error);
                    })
                //refresh = setTimeout(this.get_api_data,6000);

                sleep(900).then(() => {
                    that.loading = false;
                })
            }
        }
    })

    //var refresh = setTimeout(app.get_api_data,6000);

    {% comment %} function check_tag(){
        var tag_str_list = '';
        $('.tag').each(function(i,e){
            if ($(this).is('.line-through')){
            }
            else{
                tag_str_list = tag_str_list + $(this).text() + ',';
            }
        })
        $('#tags').val(tag_str_list);
        //console.log(tag_str_list)
    }

    setTimeout("check_tag()", 100); {% endcomment %}

{% comment %}
    $('#AufmuÌˆpfigkeit').on("click",function(){
        if ($('#AufmuÌˆpfigkeit').is('.line-through')){
            $("#AufmuÌˆpfigkeit").removeClass("line-through");
        }
        else{
            $("#AufmuÌˆpfigkeit").addClass("line-through");
        }
    })

    $('#Autonomie').on("click",function(){
        if ($('#Autonomie').is('.line-through')){
            $("#Autonomie").removeClass("line-through");
        }
        else{
            $("#Autonomie").addClass("line-through");
        }
    })

    $('#Dominanz').on("click",function(){
        if ($('#Dominanz').is('.line-through')){
            $("#Dominanz").removeClass("line-through");
        }
        else{
            $("#Dominanz").addClass("line-through");
        }
    })

    $('#Effizienz').on("click",function(){
        if ($('#Effizienz').is('.line-through')){
            $("#Effizienz").removeClass("line-through");
        }
        else{
            $("#Effizienz").addClass("line-through");
        }
    })

    $('#Ehrgeiz').on("click",function(){
        if ($('#Ehrgeiz').is('.line-through')){
            $("#Ehrgeiz").removeClass("line-through");
        }
        else{
            $("#Ehrgeiz").addClass("line-through");
        }
    })

    $('#Einzigartigkeit').on("click",function(){
        if ($('#Einzigartigkeit').is('.line-through')){
            $("#Einzigartigkeit").removeClass("line-through");
        }
        else{
            $("#Einzigartigkeit").addClass("line-through");
        }
    })

    $('#Erfolg').on("click",function(){
        if ($('#Erfolg').is('.line-through')){
            $("#Erfolg").removeClass("line-through");
        }
        else{
            $("#Erfolg").addClass("line-through");
        }
    })

    $('#FlexibilitaÌˆt').on("click",function(){
        if ($('#FlexibilitaÌˆt').is('.line-through')){
            $("#FlexibilitaÌˆt").removeClass("line-through");
        }
        else{
            $("#FlexibilitaÌˆt").addClass("line-through");
        }
    })

    $('#Freundschaft').on("click",function(){
        if ($('#Freundschaft').is('.line-through')){
            $("#Freundschaft").removeClass("line-through");
        }
        else{
            $("#Freundschaft").addClass("line-through");
        }
    })

    $('#Gelassenheit').on("click",function(){
        if ($('#Gelassenheit').is('.line-through')){
            $("#Gelassenheit").removeClass("line-through");
        }
        else{
            $("#Gelassenheit").addClass("line-through");
        }
    })

    $('#Gerechtigkeit').on("click",function(){
        if ($('#Gerechtigkeit').is('.line-through')){
            $("#Gerechtigkeit").removeClass("line-through");
        }
        else{
            $("#Gerechtigkeit").addClass("line-through");
        }
    })

    $('#Geselligkeit').on("click",function(){
        if ($('#Geselligkeit').is('.line-through')){
            $("#Geselligkeit").removeClass("line-through");
        }
        else{
            $("#Geselligkeit").addClass("line-through");
        }
    })

    $('#Gleichberechtigung').on("click",function(){
        if ($('#Gleichberechtigung').is('.line-through')){
            $("#Gleichberechtigung").removeClass("line-through");
        }
        else{
            $("#Gleichberechtigung").addClass("line-through");
        }
    })

    $('#GroÃŸzuÌˆgigkeit').on("click",function(){
        if ($('#GroÃŸzuÌˆgigkeit').is('.line-through')){
            $("#GroÃŸzuÌˆgigkeit").removeClass("line-through");
        }
        else{
            $("#GroÃŸzuÌˆgigkeit").addClass("line-through");
        }
    })

    $('#Imagination').on("click",function(){
        if ($('#Imagination').is('.line-through')){
            $("#Imagination").removeClass("line-through");
        }
        else{
            $("#Imagination").addClass("line-through");
        }
    })

    $('#Leidenschaft').on("click",function(){
        if ($('#Leidenschaft').is('.line-through')){
            $("#Leidenschaft").removeClass("line-through");
        }
        else{
            $("#Leidenschaft").addClass("line-through");
        }
    })

    $('#LoyalitaÌˆt').on("click",function(){
        if ($('#LoyalitaÌˆt').is('.line-through')){
            $("#LoyalitaÌˆt").removeClass("line-through");
        }
        else{
            $("#LoyalitaÌˆt").addClass("line-through");
        }
    })

    $('#Mut').on("click",function(){
        if ($('#Mut').is('.line-through')){
            $("#Mut").removeClass("line-through");
        }
        else{
            $("#Mut").addClass("line-through");
        }
    })

    $('#Aufrichtigkeit').on("click",function(){
        if ($('#Aufrichtigkeit').is('.line-through')){
            $("#Aufrichtigkeit").removeClass("line-through");
        }
        else{
            $("#Aufrichtigkeit").addClass("line-through");
        }
    })

    $('#Nachhaltigkeit').on("click",function(){
        if ($('#Nachhaltigkeit').is('.line-through')){
            $("#Nachhaltigkeit").removeClass("line-through");
        }
        else{
            $("#Nachhaltigkeit").addClass("line-through");
        }
    })

    $('#Neugier').on("click",function(){
        if ($('#Neugier').is('.line-through')){
            $("#Neugier").removeClass("line-through");
        }
        else{
            $("#Neugier").addClass("line-through");
        }
    })

    $('#Offenheit').on("click",function(){
        if ($('#Offenheit').is('.line-through')){
            $("#Offenheit").removeClass("line-through");
        }
        else{
            $("#Offenheit").addClass("line-through");
        }
    })

    $('#Sicherheit').on("click",function(){
        if ($('#Sicherheit').is('.line-through')){
            $("#Sicherheit").removeClass("line-through");
        }
        else{
            $("#Sicherheit").addClass("line-through");
        }
    })

    $('#Sinnhaftigkeit').on("click",function(){
        if ($('#Sinnhaftigkeit').is('.line-through')){
            $("#Sinnhaftigkeit").removeClass("line-through");
        }
        else{
            $("#Sinnhaftigkeit").addClass("line-through");
        }
    })

    $('#SolidaritÃ¤t').on("click",function(){
        if ($('#SolidaritÃ¤t').is('.line-through')){
            $("#SolidaritÃ¤t").removeClass("line-through");
        }
        else{
            $("#SolidaritÃ¤t").addClass("line-through");
        }
    })

    $('#Sorgfalt').on("click",function(){
        if ($('#Sorgfalt').is('.line-through')){
            $("#Sorgfalt").removeClass("line-through");
        }
        else{
            $("#Sorgfalt").addClass("line-through");
        }
    })

    $('#VergnuÌˆgen').on("click",function(){
        if ($('#VergnuÌˆgen').is('.line-through')){
            $("#VergnuÌˆgen").removeClass("line-through");
        }
        else{
            $("#VergnuÌˆgen").addClass("line-through");
        }
    })

    $('#Vertrautheit').on("click",function(){
        if ($('#Vertrautheit').is('.line-through')){
            $("#Vertrautheit").removeClass("line-through");
        }
        else{
            $("#Vertrautheit").addClass("line-through");
        }
    })

    $('#WuÌˆrde').on("click",function(){
        if ($('#WuÌˆrde').is('.line-through')){
            $("#WuÌˆrde").removeClass("line-through");
        }
        else{
            $("#WuÌˆrde").addClass("line-through");
        }
    })

    $('#ZuverlaÌˆssigkeit').on("click",function(){
        if ($('#ZuverlaÌˆssigkeit').is('.line-through')){
            $("#ZuverlaÌˆssigkeit").removeClass("line-through");
        }
        else{
            $("#ZuverlaÌˆssigkeit").addClass("line-through");
        }
    }) {% endcomment %}

</script>

</body>
</html>
