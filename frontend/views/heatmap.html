{% load i18n %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="icon" href="/static/images/favicon.ico"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"/>
    <meta name="theme-color" content="#51ceec"/>
    <meta name="description" content="ARK"/>
    <title>Team-HEATMAP</title>
    <link rel="stylesheet" href="/static/css/app.css">
    <link rel="stylesheet" href="/static/css/heatmap.css">
</head>
<body>
  {% get_current_language as LANGUAGE_CODE %}
  <div class="app">
    <div class="app__head">
        <header class="header-main container">
            <div class="header-main__title">
                <span class="icon-logo"></span>
                <span>ARK</span>
            </div>
            <div class="header-main__user">
                <div class="user">
                    <div class="user__subtitle">
                        {{game.name}}
                    </div>
                    <img src="{{user.avatar}}" alt="boar">
                    <div class="user__title">
                        {{user.name}}
                    </div>

                </div>
            </div>
            <div class="header-main__progress">
                <div class="progress">
                    <label>Mirror</label>
                    <div class="progress__bar">
                        <div style="width: 99%">99%</div>
                  </div>
                </div>
            </div>
        </header>
    </div>
    <div class="app__body" id="app-1">
    
    
    <div class="container">
    	<h1>{% trans "Team-Beef-Dashboard" %}</h1>
		<p>
			{% trans "Das Team-Beef-Dashboard zeigt, in welchen Paarkonstellationen die Abweichung zwischen den Selbst- und Fremdeinschätzungen gering ausfällt. Sprich, welche Paare ihre Wirkung aufeinander gut einschätzen können und untereinander wahrscheinlich wenig Spannungen erleben." %}
			<br><br>
		</p>
		<p>
			{% trans "In dieser Liste sind alle Paarkonstellationen mit Spannungswert aufgeführt. Je weiter oben ein Paar steht, desto integrierender für das Teamzusammenspiel wird die Konstellation vermutlich sein. Paare weiter unten auf der Liste produzieren höhere Spannungswerte, mehr Reibung in den gegenseitigen Wahrnehmungen und haben vermutlich Beef miteinandern – sie täten zum Wohle der Gruppe gut daran, sich in den unterschiedlichen Sichtweisen abzugleichen und ihre soziale Sensibilität zu entwickeln." %}
		</p>
			
		<div class="dashboard">
			
			<div v-bind:class="['beef-table-tools', (user_to_group ? '' : 'hide')]">
				<p>
					<a href="" v-on:click.stop.prevent="clearUserToGroup()">
						Auswahl löschen &nbsp;&nbsp;&times;
					</a>
				</p>
			</div>
			<table class="beef-table">
				<thead>
					<tr>
						<th v-bind:class="current_sort_column == 'user1' ? 'active' : ''">
							<span>Spieler</span>
						</th>
						<th v-bind:class="current_sort_column == 'tension' ? 'active' : ''">
							<span>Spannungswert</span>
						</th>
						<th v-bind:class="current_sort_column == 'user2' ? 'active' : ''">
							<span>Mitspieler</span>
						</th>
					</tr>
				</thead>
				<tbody>
				<tr v-for="(item, index) in sorted_beef_table">
					<td v-bind:class="user_to_group == item.user1.name ? 'active' : ''">
						<a v-on:click.stop.prevent="setUserToGroup(item.user1)" href="">
							[[ item.user1.name ]]
						</a>
					</td>
					<td>
						[[ item.tension ]]
					</td>
					<td v-bind:class="user_to_group == item.user2.name ? 'active' : ''"> 
						<a v-on:click.stop.prevent="setUserToGroup(item.user2)" href="">
							[[ item.user2.name ]]
						</a>
					</td>
				</tbody>
			</table>

			<p class="font-size-small">Hinweis: Klicke auf einen Namen, damit dieser Name nur in der linken Spalte gezeigt wird.</p>

		</div>
	</div>

        <div class="container">
          <h1>{% trans "Team Heatmap" %}</h1>
          <p>{% trans "Die Heatmap zeigt eine aggregierte Auswertung der Quellen aller Spannungen im Team: " %}<br><br></p>
            <ul>
              <li>
                {% trans "Auf der Vertikalen den Beitrag jedes Spielers zu den Energiequellen. Je niedriger der Wert, desto grösser ist der Beitrag zu den Energiequellen im Team." %}<br> 
              </li>
              <li>
                {% trans "Auf der Horizontalen links die Lage der Safe Zones und rechts die Skalen mit den Kraftquellen und Energiefressern des Teams – je höher der Wert, desto grösser ist der Beitrag dieser Skala zu den Energiefressern im Team." %}
              </li>
            </ul>
        <div class="heatmap">

          <div class="main-column left">
            <div class="corner"></div>
            
              <div class="heat_value property_value" v-for="value in scale_value_list">[[ value -16]]-[[ value +16]]</div>
              {% comment %} <div class="heat_value property_value">200</div>
              <div class="heat_value property_value">250</div>
              <div class="heat_value property_value">300</div>
              <div class="heat_value property_value">350</div> {% endcomment %}
            
            <div class="corner"></div>
          </div>

          <div class="main-column player" v-for="user in main_map">
            <div class="heat_value over_player">[[ user[0] ]]</div>
            <div v-for="value in user[3]" v-bind:class="{ 'heat_value one': value[1]==='yellow', 'heat_value two': value[1]==='black', 'heat_value three': value[1]==='None', 'heat_value four': value[1]==='red' }">[[ keepTwoDecimal(value[0]) ]]</div>
            {% comment %} <div class="heat_value one">[[ user[4] ]]</div>
            <div class="heat_value two">[[ user[5] ]]</div>
            <div class="heat_value one">[[ user[6] ]]</div>
            <div class="heat_value three"></div> {% endcomment %}
            <div class="heat_value average-by-player">[[ user[4] ]]</div>
            <div class="heat_player">
            <div class="name">[[ user[1] ]]</div>
            <div class="heat_player">
            <img :src="user[2]" alt="">
            </div>
            </div>
          </div>

{% comment %} 
          <div class="main-column player">
            <div class="heat_value over_player">300</div>
            <div class="heat_value four">103</div>
            <div class="heat_value two">58</div>
            <div class="heat_value one">95</div>
            <div class="heat_value three">73</div>
            <div class="heat_value one">50</div>
            <div class="heat_value average-by-player">100</div>
            <div class="heat_player">
            <div class="name">Paula Fernandes</div>
            <img src="/static/images/avatars/bear.svg" alt="">
            </div>
          </div>

          <div class="main-column player">
            <div class="heat_value over_player">250</div>
            <div class="heat_value one">114</div>
            <div class="heat_value three">113</div>
            <div class="heat_value one">125</div>
            <div class="heat_value four">37</div>
            <div class="heat_value two">76</div>
            <div class="heat_value average-by-player">99</div>
            <div class="heat_player">
            <div class="name">Paula Fernandes</div>
            <img src="/static/images/avatars/bear.svg" alt="">
            </div>
          </div>

          <div class="main-column player">
            <div class="heat_value over_player">150</div>
            <div class="heat_value four">90</div>
            <div class="heat_value one">99</div>
            <div class="heat_value three">78</div>
            <div class="heat_value two">70</div>
            <div class="heat_value one">67</div>
            <div class="heat_value average-by-player">64</div>
            <div class="heat_player">
            <div class="name">Paula Fernandes</div>
            <img src="/static/images/avatars/bear.svg" alt="">
            </div>
          </div>

          <div class="main-column player">
            <div class="heat_value over_player">100</div>
            <div class="heat_value one">183</div>
            <div class="heat_value two">149</div>
            <div class="heat_value one">127</div>
            <div class="heat_value four">68</div>
            <div class="heat_value three">101</div>
            <div class="heat_value average-by-player">65</div>
            <div class="heat_player">
            <div class="name">Paula Fernandes</div>
            <img src="/static/images/avatars/bear.svg" alt="">
            </div>
          </div> {% endcomment %}



          <div class="main-column prop">
            <div class="corner"></div>
            <div class="property" v-for="scale in scale_list_pro">
              <p class="property_one">[[ scale[0] ]]</p>
              <p class="property_two">[[ scale[1] ]]</p>
            </div>
            {% comment %} <div class="property">
              <p class="property_one">Curative</p>
              <p class="property_two">Narcissism</p>
            </div>
            <div class="property">
              <p class="property_one">Ambition</p>
              <p class="property_two">Enforcement</p>
            </div>
            <div class="property">
              <p class="property_one">Victory</p>
              <p class="property_two">Dominance</p>
            </div>
            <div class="property">
              <p class="property_one">Pain</p>
              <p class="property_two">Invisibility</p>
            </div> {% endcomment %}
            <div class="corner"></div>
          </div>

          <div class="main-column right">
            <div class="corner"></div>
            
              <div class="heat_value property_value" v-for="value in scale_value_list">[[ value ]]</div>
              {% comment %} <div class="heat_value property_value">200</div>
              <div class="heat_value property_value">250</div>
              <div class="heat_value property_value">300</div>
              <div class="heat_value property_value">350</div> {% endcomment %}
            
            <div class="corner"></div>
          </div>


        </div>
    </div>
  </div>

  <script src="/static/vue.js"></script>
  <script src="/static/axios.min.js"></script>
  <script>
  var app_ = new Vue({
    delimiters: ['[[', ']]'],
    el: '#app-1',
    data:{
      row0: {{ row0|safe }},
      main_map: {{ main_map|safe }},
      scale_list: {{ scale_list|safe }},
      scale_value_list: {{ scale_value_list|safe }},
      beef_table: {{ beef_table|safe }},
      lang_code: '{{LANGUAGE_CODE}}',
      
      current_sort_column: 'tension',
      user_to_group: '',
      
      //debug: '{{debug|safe}}',
      //debug2: '{{debug2|safe}}',
      //debug3: '{{debug3|safe}}'
    },
    computed:{
      scale_list_pro:function(){
        var result = []
        this.scale_list.forEach((item)=>{
          result.push(
            [item[0][this.lang_code], item[1][this.lang_code]]
          )
        })
        return result
      },
      sorted_beef_table:function() {
      	var sorted = [];
      	var userToGroup = this.$data.user_to_group;
      	for (var i=0; i < this.$data.beef_table.length; i++) {
      		
      		var row = this.$data.beef_table[i];
      		
      		if (userToGroup) {
      			if (row['user1'].name == userToGroup) {
      				sorted.push(row);
      			} else if (row['user2'].name == userToGroup) {
      				finalRow = { 'user1' : row['user2'], 'tension' : row['tension'], 'user2' : row['user1'] }
		      		sorted.push(finalRow);
      			} else {
      				sorted.push(row);
      			}
      		} else {
	      		sorted.push(row);
      		}
      	}

      	sorted.sort(function(a, b) {
      		var current_sort_column = this.$data.current_sort_column;

      		var attriName = 'tension';
      		
      		var valueA = a[attriName];
      		var valueB = b[attriName];
      		
      		var result = 0;
      		if (valueA > valueB) {
      			result = 1;
      		} else if (valueA < valueB) {
      			result = -1;
      		} 
      		return result;
      	}.bind(this))

      	return sorted;
      }
    },
    methods:{
      keepTwoDecimal(num) {  
        var result = parseFloat(num);  
        if (isNaN(result)) {  
          alert('error, please check！');  
            return false;  
          }  
          result = Math.round(num * 100) / 100;  
          return result;  
       },
       setUserToGroup(user) {
       	this.$data.user_to_group = user.name;
       },
       clearUserToGroup() {
       	this.$data.user_to_group = '';
       }
    }
  })
  let playersCount = {{user_number}};; 
  let heatmapEl = document.querySelector('.heatmap');
  heatmapEl.style.gridTemplateColumns = `[lft] minmax(50px, 100px) repeat(${playersCount}, minmax(50px, 100px)) [prop] 150px [rght] minmax(50px, 100px) `

  </script>

         <div class="container">
          <ul>
            <li>
              {% trans "Im Innern der Heatmap steht, wie gross die Abweichung zwischen Selbst- und Fremdwahrnehmung hinsichtlich des Beitrags zu den Kraftquellen und Energiefressern im Team ist." %}
            </li>
            <li>
              {% trans "Bei negativen Vorzeichen schätzt der Spieler den Beitrag zur Teamdynamik eher zu positiv ein." %} 
            </li>
            <li>
              {% trans "Werte über 16 deuten auf Spannungen mit dem Team hin." %}<br><br><br>
            </li>
          </ul>
        </div>
  

  <div class="center">
      <a href="/farewell/" class="button" id="button">
                        {% trans "Auf Wiedersehen sagen" %}
      </a>  
  </div>  

</body>
</html>
